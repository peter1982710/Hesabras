<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ ÙØ±ÙˆØ´ Ù‡ÛŒØ¯ÛŒÙØ§ÛŒ</title>
    
    <!-- Styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <style>
        body { font-family: 'Vazirmatn', sans-serif; background-color: #f3f4f6; }
        .animate-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Loading & Error Styles */
        #root:empty { min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        #root:empty::after {
            content: 'Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³ÛŒØ³ØªÙ…...';
            color: #4f46e5;
            font-weight: bold;
            font-size: 1.2rem;
        }
        .error-box {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.95); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px; text-align: center; direction: ltr;
        }
    </style>

    <!-- FIXED Import Map: Only React 18, Forced Dependency for Lucide -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.469.0?deps=react@18.2.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <!-- System Check Script -->
    <script>
        window.onerror = function(msg, url, line, col, error) {
            document.body.innerHTML += `
                <div class="error-box" style="color:red; border:2px solid red;">
                    <h2 style="font-size:20px; margin-bottom:10px;">Javascript Error</h2>
                    <p><b>Message:</b> ${msg}</p>
                    <p><b>Line:</b> ${line}</p>
                    <p style="margin-top:20px; color:#555;">Ø§Ú¯Ø± Ø§ÛŒÙ† Ø®Ø·Ø§ Ø±Ø§ Ù…ÛŒâ€ŒØ¨ÛŒÙ†ÛŒØ¯ØŒ Ù„Ø·ÙØ§ Ú©Ø´ Ù…Ø±ÙˆØ±Ú¯Ø± Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.</p>
                </div>
            `;
            return false;
        };

        // Check API Connection immediately
        fetch('api.php').then(res => {
            if(!res.ok && res.status !== 200) {
                console.warn('API Warning: api.php might not be accessible. Status:', res.status);
            }
        }).catch(err => {
            console.error('API Error: Could not connect to api.php. Is it uploaded?', err);
        });
    </script>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Users, Settings, LayoutDashboard, Store, CloudUpload, Receipt, 
            Search, Send, CheckCircle2, AlertTriangle, Fingerprint, 
            X, ChevronLeft, Plus, Trash2, TrendingUp, AlertCircle, 
            Save, Coins, Percent, Edit2, Bot, Database, User as UserIcon, 
            Key, Server, Globe, Zap, RefreshCw, Upload, FileJson, DollarSign,
            Loader2, FileText
        } from 'lucide-react';

        // --- Types & Defaults ---
        const DEFAULT_SETTINGS = {
            pricePerGb: 5000,
            profitPercentage: 10,
            warningDays: 7,
            hostDomain: '',
            telegramBotToken: '',
            adminTelegramId: '',
            dbName: '',
            dbUser: '',
            dbPassword: '',
        };

        // --- API Services ---
        const fetchData = async () => {
            try {
                const response = await fetch('api.php');
                if (!response.ok) throw new Error('Network error: ' + response.status);
                const text = await response.text();
                try {
                    const data = JSON.parse(text);
                    return {
                        users: data.users || [],
                        settings: { ...DEFAULT_SETTINGS, ...data.settings }
                    };
                } catch (e) {
                    console.error("JSON Parse Error. Response was:", text);
                    return { users: [], settings: DEFAULT_SETTINGS };
                }
            } catch (error) {
                console.error("Fetch Error:", error);
                return { users: [], settings: DEFAULT_SETTINGS };
            }
        };

        const saveData = async (data) => {
            try {
                const response = await fetch('api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                });
                return response.ok;
            } catch (error) {
                console.error("Save Error:", error);
                return false;
            }
        };

        // --- Components ---

        const Sidebar = ({ currentPage, onChangePage }) => {
            const menuItems = [
                { id: 'dashboard', label: 'Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯', icon: LayoutDashboard },
                { id: 'users', label: 'ÛŒÙˆØ²Ø±Ù‡Ø§', icon: Users },
                { id: 'bill', label: 'ØµÙˆØ±Øªâ€ŒØ­Ø³Ø§Ø¨', icon: Receipt },
                { id: 'backup', label: 'Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ú¯ÛŒØ±ÛŒ', icon: CloudUpload },
                { id: 'settings', label: 'ØªÙ†Ø¸ÛŒÙ…Ø§Øª', icon: Settings },
            ];

            // Obfuscated string: "Ù†ÙˆØ´ØªÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ø²Ù…Ø§Ù†"
            const _dev = String.fromCharCode(...[1606,1608,1588,1578,1607,32,1588,1583,1607,32,1578,1608,1587,1591,32,1586,1605,1575,1606]);

            return (
                <div className="w-64 bg-slate-800 text-white min-h-screen flex flex-col shadow-xl hidden md:flex sticky top-0 h-screen">
                    <div className="p-6 border-b border-slate-700">
                        <div className="flex items-center gap-3">
                            <div className="bg-indigo-500 p-2 rounded-lg shrink-0">
                                <Store size={24} />
                            </div>
                            <div>
                                <h2 className="font-bold text-lg leading-tight">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
                                <span className="text-[11px] text-slate-400 block mt-1">Ù†Ø³Ø®Ù‡ Û±.Û°.Û±</span>
                            </div>
                        </div>
                    </div>
                    
                    <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
                        {menuItems.map((item) => {
                            const Icon = item.icon;
                            const isActive = currentPage === item.id;
                            return (
                                <button
                                    key={item.id}
                                    onClick={() => onChangePage(item.id)}
                                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 ${
                                        isActive ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-700 hover:text-white'
                                    }`}
                                >
                                    <Icon size={20} />
                                    <span className="font-medium">{item.label}</span>
                                </button>
                            );
                        })}
                    </nav>

                    <div className="p-4 bg-slate-900/50 border-t border-slate-700 text-center">
                        <p className="text-[11px] text-slate-500 font-medium mb-3 select-none">{_dev}</p>
                        <div className="bg-slate-800/80 rounded-lg p-2 border border-slate-700">
                             <span className="text-[10px] text-slate-400 block mb-1">Ø¬Ù‡Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</span>
                             <a href="https://t.me/king_service2" target="_blank" className="text-xs font-mono text-indigo-400 hover:text-indigo-300 transition-colors block" dir="ltr">@king_service2</a>
                        </div>
                    </div>
                </div>
            );
        };

        const MobileNav = ({ currentPage, onChangePage }) => {
            return (
                <div className="md:hidden fixed bottom-0 right-0 left-0 bg-white border-t border-gray-200 flex justify-around p-3 z-50 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
                    {[
                        { id: 'dashboard', label: 'Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯', icon: LayoutDashboard },
                        { id: 'users', label: 'Ú©Ø§Ø±Ø¨Ø±Ø§Ù†', icon: Users },
                        { id: 'bill', label: 'ØµÙˆØ±ØªØ­Ø³Ø§Ø¨', icon: Receipt },
                        { id: 'backup', label: 'Ø¨Ú©Ø§Ù¾', icon: CloudUpload },
                        { id: 'settings', label: 'ØªÙ†Ø¸ÛŒÙ…Ø§Øª', icon: Settings }
                    ].map(item => (
                        <button
                            key={item.id}
                            onClick={() => onChangePage(item.id)}
                            className={`flex flex-col items-center gap-1 ${currentPage === item.id ? 'text-indigo-600' : 'text-gray-400'}`}
                        >
                            <item.icon size={20} />
                            <span className="text-[10px] font-medium">{item.label}</span>
                        </button>
                    ))}
                </div>
            );
        };

        const StatCard = ({ title, value, icon, colorClass }) => (
            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center justify-between">
                <div>
                    <p className="text-sm text-slate-500 mb-1">{title}</p>
                    <h3 className="text-2xl font-bold text-slate-800">{value}</h3>
                </div>
                <div className={`p-3 rounded-xl ${colorClass}`}>{icon}</div>
            </div>
        );

        const DashboardPage = ({ users, settings }) => {
            const calculatePrice = (gb) => (gb * settings.pricePerGb) * (1 + settings.profitPercentage / 100);
            
            const totalRevenue = users.reduce((acc, user) => acc + calculatePrice(user.purchasedGb), 0);
            const totalGbSold = users.reduce((acc, user) => acc + user.purchasedGb, 0);
            const warningUsers = users.filter(user => {
                const lastCheck = new Date(user.lastCheckDate || user.purchaseDate).getTime();
                const diffDays = (Date.now() - lastCheck) / (1000 * 3600 * 24);
                return diffDays > settings.warningDays;
            }).length;

            return (
                <div className="space-y-6 animate-in">
                    <div className="flex items-center gap-3 mb-6">
                        <div className="bg-indigo-100 p-2 rounded-xl text-indigo-600"><TrendingUp size={24} /></div>
                        <h2 className="text-2xl font-bold text-slate-800">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ùˆ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ</h2>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <StatCard title="Ú©Ù„ ÙØ±ÙˆØ´ (ØªÙˆÙ…Ø§Ù†)" value={Math.round(totalRevenue).toLocaleString()} icon={<DollarSign className="text-emerald-600" />} colorClass="bg-emerald-100" />
                        <StatCard title="Ø­Ø¬Ù… ÙØ±ÙˆØ®ØªÙ‡ Ø´Ø¯Ù‡" value={`${totalGbSold} GB`} icon={<Database className="text-blue-600" />} colorClass="bg-blue-100" />
                        <StatCard title="Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ" value={`${warningUsers} Ú©Ø§Ø±Ø¨Ø±`} icon={<AlertCircle className="text-amber-600" />} colorClass="bg-amber-100" />
                    </div>
                </div>
            );
        };

        const UsersPage = ({ users, settings, onAddUser, onUpdateConsumption, onDeleteUser }) => {
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isConsumeModalOpen, setIsConsumeModalOpen] = useState(false);
            const [selectedUserId, setSelectedUserId] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);
            const [userToDelete, setUserToDelete] = useState(null);
            
            // Form states
            const [newName, setNewName] = useState('');
            const [newGb, setNewGb] = useState('');
            const [newDate, setNewDate] = useState('');
            const [newTelegramId, setNewTelegramId] = useState('');
            const [consumeAmount, setConsumeAmount] = useState('');

            const filteredUsers = useMemo(() => users.filter(u => u.name.toLowerCase().includes(searchTerm.toLowerCase())), [users, searchTerm]);

            const handleAddSubmit = (e) => {
                e.preventDefault();
                onAddUser({
                    name: newName,
                    purchasedGb: Number(newGb),
                    consumedGb: 0,
                    purchaseDate: newDate,
                    telegramId: newTelegramId || undefined,
                    lastCheckDate: new Date().toISOString()
                });
                setIsModalOpen(false);
                setNewName(''); setNewGb(''); setNewDate(''); setNewTelegramId('');
            };

            return (
                <div className="space-y-6 pb-20 md:pb-0 animate-in">
                     <div className="flex flex-col md:flex-row gap-4 justify-between items-center bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                        <div className="relative w-full md:w-96">
                            <Search className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400" size={20} />
                            <input type="text" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full pr-10 pl-4 py-2 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                        </div>
                        <button onClick={() => setIsModalOpen(true)} className="w-full md:w-auto bg-indigo-600 text-white px-6 py-2.5 rounded-xl flex items-center justify-center gap-2 shadow-lg shadow-indigo-600/20"><Plus size={20} /><span>Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</span></button>
                    </div>

                    <div className="grid grid-cols-1 gap-4">
                        {filteredUsers.length === 0 ? <div className="text-center py-10 text-slate-400">Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</div> : filteredUsers.map(user => {
                            const lastCheck = new Date(user.lastCheckDate || user.purchaseDate).getTime();
                            const isWarning = ((Date.now() - lastCheck) / (1000 * 3600 * 24)) > settings.warningDays;
                            const percentageUsed = (user.consumedGb / user.purchasedGb) * 100;
                            const remaining = user.purchasedGb - user.consumedGb;

                            return (
                                <div key={user.id} className={`bg-white p-5 rounded-2xl shadow-sm border ${isWarning ? 'border-amber-300 bg-amber-50/30' : 'border-slate-100'}`}>
                                    <div className="flex flex-col md:flex-row justify-between gap-4">
                                        <div className="flex-1 space-y-2">
                                            <div className="flex items-center gap-2">
                                                <h3 className="font-bold text-lg text-slate-800">{user.name}</h3>
                                                {isWarning && <span className="bg-amber-100 text-amber-700 text-xs px-2 py-1 rounded-full flex items-center gap-1"><AlertCircle size={12} />Ø¨Ø±Ø±Ø³ÛŒ Ù…ØµØ±Ù</span>}
                                            </div>
                                            <div className="text-sm text-slate-500">
                                                <span>Ø®Ø±ÛŒØ¯: {new Date(user.purchaseDate).toLocaleDateString('fa-IR')}</span>
                                                {user.telegramId && <div className="flex items-center gap-1 text-xs text-indigo-500 mt-1"><Fingerprint size={12} /><span>ID: {user.telegramId}</span></div>}
                                            </div>
                                        </div>
                                        <div className="flex-1 flex flex-col justify-center">
                                            <div className="flex justify-between text-sm mb-1"><span className="text-slate-600">{user.consumedGb} GB</span><span className="text-slate-600">{user.purchasedGb} GB</span></div>
                                            <div className="w-full bg-slate-100 rounded-full h-3 overflow-hidden">
                                                <div className={`h-full rounded-full transition-all duration-500 ${percentageUsed > 90 ? 'bg-red-500' : percentageUsed > 70 ? 'bg-amber-500' : 'bg-emerald-500'}`} style={{ width: `${Math.min(percentageUsed, 100)}%` }}></div>
                                            </div>
                                            <div className="text-xs text-left mt-1 text-slate-400">Ø¨Ø§Ù‚ÛŒ: {remaining.toFixed(2)} GB</div>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <button onClick={() => { setSelectedUserId(user.id); setConsumeAmount(''); setIsConsumeModalOpen(true); }} className="bg-blue-50 text-blue-600 p-2.5 rounded-xl hover:bg-blue-100"><TrendingUp size={20} /></button>
                                            <button onClick={() => { setUserToDelete(user); setIsDeleteModalOpen(true); }} className="bg-red-50 text-red-600 p-2.5 rounded-xl hover:bg-red-100"><Trash2 size={20} /></button>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {isModalOpen && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl animate-in">
                                <h3 className="text-xl font-bold mb-4">Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</h3>
                                <form onSubmit={handleAddSubmit} className="space-y-4">
                                    <input required type="text" value={newName} onChange={e=>setNewName(e.target.value)} className="w-full p-3 bg-slate-50 border rounded-xl" placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ" />
                                    <input required type="number" value={newGb} onChange={e=>setNewGb(e.target.value)} className="w-full p-3 bg-slate-50 border rounded-xl" placeholder="Ø­Ø¬Ù… (GB)" />
                                    <input type="text" dir="ltr" value={newTelegramId} onChange={e=>setNewTelegramId(e.target.value)} className="w-full p-3 bg-slate-50 border rounded-xl text-left" placeholder="Telegram ID (Optional)" />
                                    <input required type="date" value={newDate} onChange={e=>setNewDate(e.target.value)} className="w-full p-3 bg-slate-50 border rounded-xl" />
                                    <div className="flex gap-3 mt-6"><button type="button" onClick={()=>setIsModalOpen(false)} className="flex-1 py-3 bg-slate-100 rounded-xl">Ø§Ù†ØµØ±Ø§Ù</button><button type="submit" className="flex-1 bg-indigo-600 text-white rounded-xl py-3">Ø°Ø®ÛŒØ±Ù‡</button></div>
                                </form>
                            </div>
                        </div>
                    )}

                    {isConsumeModalOpen && (
                         <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl animate-in">
                                <h3 className="text-xl font-bold mb-4">Ú©Ø³Ø± Ø­Ø¬Ù… Ù…ØµØ±Ù Ø´Ø¯Ù‡</h3>
                                <form onSubmit={(e) => { e.preventDefault(); onUpdateConsumption(selectedUserId, Number(consumeAmount)); setIsConsumeModalOpen(false); }} className="space-y-4">
                                    <input required type="number" step="0.1" value={consumeAmount} onChange={e => setConsumeAmount(e.target.value)} className="w-full p-3 bg-slate-50 border rounded-xl" placeholder="Ù…Ù‚Ø¯Ø§Ø± Ù…ØµØ±Ù Ø´Ø¯Ù‡ (GB)" />
                                    <div className="flex gap-3 mt-6"><button type="button" onClick={()=>setIsConsumeModalOpen(false)} className="flex-1 py-3 bg-slate-100 rounded-xl">Ø§Ù†ØµØ±Ø§Ù</button><button type="submit" className="flex-1 bg-amber-500 text-white rounded-xl py-3">Ú©Ø³Ø± Ø­Ø¬Ù…</button></div>
                                </form>
                            </div>
                        </div>
                    )}
                    
                    {isDeleteModalOpen && (
                         <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl animate-in text-center">
                                <h3 className="text-xl font-bold mb-2">Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø±</h3>
                                <p className="mb-4 text-slate-500">Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù {userToDelete?.name} Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ</p>
                                <div className="flex gap-3"><button onClick={()=>setIsDeleteModalOpen(false)} className="flex-1 py-3 bg-slate-100 rounded-xl">Ø®ÛŒØ±</button><button onClick={() => { onDeleteUser(userToDelete.id); setIsDeleteModalOpen(false); }} className="flex-1 bg-red-500 text-white rounded-xl py-3">Ø¨Ù„Ù‡ØŒ Ø­Ø°Ù Ú©Ù†</button></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const BillPage = ({ users, settings }) => {
            const [searchId, setSearchId] = useState('');
            const [selectedUser, setSelectedUser] = useState(null);
            const [manualId, setManualId] = useState('');
            const [loading, setLoading] = useState(false);
            const [status, setStatus] = useState(null);
            const [isListOpen, setIsListOpen] = useState(false);
            const [listSearchTerm, setListSearchTerm] = useState('');

            const filteredUsersList = useMemo(() => users.filter(u => u.name.toLowerCase().includes(listSearchTerm.toLowerCase())), [users, listSearchTerm]);

            const calculatePrice = (gb) => (gb * settings.pricePerGb) * (1 + settings.profitPercentage / 100);

            const handleSearch = () => {
                if (!searchId.trim()) { setListSearchTerm(''); setIsListOpen(true); return; }
                const foundUser = users.find(u => u.telegramId === searchId || u.id === searchId || u.name.toLowerCase().includes(searchId.toLowerCase()));
                if (foundUser) selectUser(foundUser);
                else { setSelectedUser(null); setManualId(''); setStatus({ success: false, message: 'Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.' }); }
            };

            const selectUser = (user) => {
                setSelectedUser(user);
                setManualId(user.telegramId || '');
                setStatus(null);
                setIsListOpen(false);
                setSearchId(user.name);
            };

            const handleSendBill = async () => {
                if (!selectedUser || !manualId) return;
                setLoading(true); setStatus(null);
                const price = calculatePrice(selectedUser.purchasedGb);
                const remaining = selectedUser.purchasedGb - selectedUser.consumedGb;
                const message = `ğŸ§¾ <b>ØµÙˆØ±Øªâ€ŒØ­Ø³Ø§Ø¨ Ø³Ø±ÙˆÛŒØ³</b>\nâ–â–â–â–â–â–â–â–\nğŸ‘¤ <b>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±:</b> ${selectedUser.name}\nğŸ†” <b>Ø´Ù†Ø§Ø³Ù‡:</b> ${manualId}\nğŸ“… <b>ØªØ§Ø±ÛŒØ® Ø®Ø±ÛŒØ¯:</b> ${selectedUser.purchaseDate}\nğŸ’¾ <b>Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡:</b> ${selectedUser.purchasedGb} GB\nğŸ“‰ <b>Ù…ØµØ±Ù Ø´Ø¯Ù‡:</b> ${selectedUser.consumedGb} GB\nâ–â–â–â–â–â–â–â–\nğŸ’° <b>Ù…Ø¨Ù„Øº:</b> ${Math.round(price).toLocaleString()} ØªÙˆÙ…Ø§Ù†\nğŸ”‹ <b>Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡:</b> ${remaining.toFixed(2)} GB`;

                try {
                    // Fix: Send sanitized ID
                    const res = await fetch('api.php?action=send_bill', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ chat_id: manualId.trim(), text: message })
                    });
                    const result = await res.json();
                    if (result.status === 'success') setStatus({ success: true, message: 'âœ… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!' });
                    else setStatus({ success: false, message: 'âŒ Ø®Ø·Ø§: ' + (result.message || 'Ù†Ø§Ù…Ø´Ø®Øµ') });
                } catch (e) { setStatus({ success: false, message: 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø·' }); }
                setLoading(false);
            };

            return (
                <div className="max-w-xl mx-auto space-y-6 animate-in">
                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <label className="block text-sm font-medium text-slate-700 mb-2">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±</label>
                        <div className="flex gap-2">
                            <div className="relative flex-1">
                                <Search className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                                <input type="text" value={searchId} onChange={(e) => setSearchId(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && handleSearch()} placeholder="Ø¬Ø³ØªØ¬Ùˆ..." className="w-full pr-10 pl-4 py-3 border border-slate-200 bg-slate-50 rounded-xl" />
                            </div>
                            <button onClick={handleSearch} className="bg-indigo-600 text-white px-4 rounded-xl">{searchId ? 'Ø¬Ø³ØªØ¬Ùˆ' : 'Ù„ÛŒØ³Øª'}</button>
                        </div>
                    </div>

                    {selectedUser && (
                        <div className="bg-white p-6 rounded-2xl shadow-sm border border-indigo-100 animate-in">
                            <div className="flex items-center gap-3 mb-6 border-b border-slate-100 pb-4">
                                <span className="bg-indigo-100 p-2 rounded-lg text-indigo-600">
                                    <FileText size={24} />
                                </span>
                                <div className="flex-1 flex justify-between items-center">
                                    <h3 className="font-bold">Ù…Ø´Ø®ØµØ§Øª ØµÙˆØ±Øªâ€ŒØ­Ø³Ø§Ø¨</h3>
                                    <span className="text-xs bg-indigo-50 text-indigo-700 px-2 py-1 rounded-full">{manualId ? 'Ø¢Ù…Ø§Ø¯Ù‡' : 'Ø¨Ø¯ÙˆÙ† Ø¢ÛŒØ¯ÛŒ'}</span>
                                </div>
                            </div>
                            <div className="bg-slate-50 p-4 rounded-xl border border-slate-200 space-y-2 text-sm">
                                <div className="flex justify-between"><span>Ú©Ø§Ø±Ø¨Ø±:</span><span className="font-bold">{selectedUser.name}</span></div>
                                <div className="flex justify-between items-center"><span>Ø¢ÛŒØ¯ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…:</span><input type="text" dir="ltr" value={manualId} onChange={e=>setManualId(e.target.value)} className="w-32 text-center border rounded px-1" /></div>
                                <div className="flex justify-between pt-2 border-t mt-2 font-bold text-lg text-emerald-600"><span>Ù…Ø¨Ù„Øº:</span><span>{Math.round(calculatePrice(selectedUser.purchasedGb)).toLocaleString()} Øª</span></div>
                            </div>
                            {status && <div className={`mt-4 p-3 rounded-xl text-sm ${status.success ? 'bg-emerald-50 text-emerald-800' : 'bg-red-50 text-red-800'}`}>{status.message}</div>}
                            <button onClick={handleSendBill} disabled={loading || !manualId} className="w-full mt-4 py-3 bg-indigo-600 text-white rounded-xl shadow-lg shadow-indigo-500/30 disabled:bg-slate-300 flex justify-center items-center gap-2">{loading ? '...' : <><Send size={18}/> Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ {manualId}</>}</button>
                        </div>
                    )}
                    
                    {isListOpen && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-2xl w-full max-w-md h-[80vh] flex flex-col shadow-2xl animate-in">
                                <div className="p-4 border-b flex justify-between"><h3>Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h3><button onClick={()=>setIsListOpen(false)}><X size={20}/></button></div>
                                <div className="p-4 bg-slate-50"><input type="text" autoFocus value={listSearchTerm} onChange={e=>setListSearchTerm(e.target.value)} className="w-full p-2 border rounded-xl" placeholder="Ø¬Ø³ØªØ¬Ùˆ..." /></div>
                                <div className="flex-1 overflow-y-auto p-2">
                                    {filteredUsersList.map(u => (
                                        <button key={u.id} onClick={()=>selectUser(u)} className="w-full flex items-center justify-between p-3 hover:bg-slate-50 border-b">
                                            <div className="flex items-center gap-3"><div className="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600"><Users size={16}/></div><div className="text-right text-sm font-bold">{u.name}</div></div>
                                            <ChevronLeft size={16} className="text-slate-400"/>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const SettingsPage = ({ settings, onSave }) => {
            const [formData, setFormData] = useState(settings);
            const [activeTab, setActiveTab] = useState('general');
            const [botLoading, setBotLoading] = useState(false);
            const [botStatus, setBotStatus] = useState(null);
            const [saved, setSaved] = useState(false);

            useEffect(() => {
                setFormData(settings);
            }, [settings]);

            const handleSubmit = (e) => { 
                e.preventDefault(); 
                onSave(formData); 
                setSaved(true);
                setTimeout(()=>setSaved(false), 2000);
            };

            const handleCreateBot = async () => {
                if (!formData.telegramBotToken || !formData.hostDomain) { 
                    setBotStatus({success:false, message:'Ù„Ø·ÙØ§ ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª Ùˆ Ø¢Ø¯Ø±Ø³ Ù†ØµØ¨ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.'}); 
                    return; 
                }
                setBotLoading(true); setBotStatus(null);
                
                // Save first
                onSave(formData);
                
                // Clean Domain & Path
                let domain = formData.hostDomain.trim();
                if (!domain.startsWith('http')) {
                    domain = 'https://' + domain;
                }
                // Remove trailing slash
                domain = domain.replace(/\/$/, "");
                
                const webhookUrl = `${domain}/bot.php`;
                const apiUrl = `https://api.telegram.org/bot${formData.telegramBotToken}/setWebhook?url=${webhookUrl}`;

                try {
                    const res = await fetch(apiUrl);
                    const data = await res.json();
                    if(data.ok) {
                        setBotStatus({ success: true, message: `âœ… ÙˆØ¨â€ŒÙ‡ÙˆÚ© Ù…ØªØµÙ„ Ø´Ø¯! Ø¢Ø¯Ø±Ø³: ${webhookUrl}` });
                    } else {
                        setBotStatus({ success: false, message: `âŒ Ø®Ø·Ø§: ${data.description}` });
                    }
                } catch (e) { 
                    setBotStatus({ success: false, message: 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ù‚Ø±Ø§Ø±ÛŒ Ø§Ø±ØªØ¨Ø§Ø·. Ù„Ø·ÙØ§ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.' }); 
                }
                setBotLoading(false);
            };

            return (
                <div className="max-w-2xl mx-auto space-y-6 animate-in">
                    <div className="flex bg-white p-1 rounded-2xl border">
                        <button onClick={()=>setActiveTab('general')} className={`flex-1 py-2 rounded-xl transition-all ${activeTab==='general'?'bg-indigo-50 text-indigo-600 font-bold':'text-slate-500'}`}>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø§Ù„ÛŒ Ùˆ Ù‡Ø´Ø¯Ø§Ø±</button>
                        <button onClick={()=>setActiveTab('telegram')} className={`flex-1 py-2 rounded-xl transition-all ${activeTab==='telegram'?'bg-blue-50 text-blue-600 font-bold':'text-slate-500'}`}>Ø±Ø¨Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù…</button>
                    </div>
                    
                    <div className="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm relative">
                         <div className="flex justify-between items-center mb-6 border-b pb-4">
                            <h2 className="font-bold text-lg text-slate-800 flex items-center gap-2">
                                {activeTab === 'general' ? <><Coins size={20} className="text-indigo-600"/> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ</> : <><Bot size={20} className="text-blue-600"/> Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ø±Ø¨Ø§Øª</>}
                            </h2>
                        </div>
                         <form onSubmit={handleSubmit} className="space-y-4">
                            {activeTab === 'general' ? (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label className="text-sm block mb-1 font-bold">Ù‚ÛŒÙ…Øª Ù‡Ø± Ú¯ÛŒÚ¯ (ØªÙˆÙ…Ø§Ù†)</label><input type="number" value={formData.pricePerGb} onChange={e=>setFormData({...formData, pricePerGb:Number(e.target.value)})} className="w-full p-3 border rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 transition-all"/></div>
                                    <div><label className="text-sm block mb-1 font-bold">Ø³ÙˆØ¯ (%)</label><input type="number" value={formData.profitPercentage} onChange={e=>setFormData({...formData, profitPercentage:Number(e.target.value)})} className="w-full p-3 border rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 transition-all"/></div>
                                    <div><label className="text-sm block mb-1 font-bold">Ø±ÙˆØ² Ù‡Ø´Ø¯Ø§Ø±</label><input type="number" value={formData.warningDays} onChange={e=>setFormData({...formData, warningDays:Number(e.target.value)})} className="w-full p-3 border rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 transition-all"/></div>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    <div>
                                        <label className="text-sm block mb-1 font-bold">Ø¢Ø¯Ø±Ø³ Ø¯Ø§Ù…Ù†Ù‡ Ùˆ Ù¾ÙˆØ´Ù‡ Ù†ØµØ¨</label>
                                        <div className="relative">
                                            <Globe className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                                            <input type="text" dir="ltr" value={formData.hostDomain} onChange={e=>setFormData({...formData, hostDomain:e.target.value})} className="w-full pr-10 pl-4 py-3 border rounded-xl text-left bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 transition-all" placeholder="https://example.com/your-folder"/>
                                        </div>
                                        <p className="text-xs text-slate-500 mt-2">Ù„Ø·ÙØ§ Ø¢Ø¯Ø±Ø³ Ø¯Ø§Ù…Ù†Ù‡ Ùˆ Ù¾ÙˆØ´Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø¯Ø§Ø®Ù„Ø´ Ù†ØµØ¨ Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ø§Ù„: https://site.com/bot-folder).</p>
                                    </div>

                                    <div>
                                        <label className="text-sm block mb-1 font-bold">ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª</label>
                                        <div className="relative">
                                            <Key className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                                            <input type="text" dir="ltr" value={formData.telegramBotToken} onChange={e=>setFormData({...formData, telegramBotToken:e.target.value})} className="w-full pr-10 pl-4 py-3 border rounded-xl text-left bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 transition-all"/>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label className="text-sm block mb-1 font-bold">Ø¢ÛŒØ¯ÛŒ Ø§Ø¯Ù…ÛŒÙ†</label>
                                        <div className="relative">
                                            <UserIcon className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                                            <input type="text" dir="ltr" value={formData.adminTelegramId} onChange={e=>setFormData({...formData, adminTelegramId:e.target.value})} className="w-full pr-10 pl-4 py-3 border rounded-xl text-left bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 transition-all"/>
                                        </div>
                                    </div>
                                    
                                    <div className="border-t pt-4 mt-4">
                                         <h3 className="text-sm font-bold mb-3 flex items-center gap-1"><Database size={16}/> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯ÛŒØªØ§Ø¨ÛŒØ³ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</h3>
                                         <p className="text-xs text-slate-500 mb-3">Ø¯Ø± ØµÙˆØ±Øª ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ù…Ø´Ø®ØµØ§Øª Ø²ÛŒØ±ØŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù‡ Ø¬Ø§ÛŒ ÙØ§ÛŒÙ„ JSON Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ MySQL Ø°Ø®ÛŒØ±Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.</p>
                                         <div className="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                                            <input type="text" dir="ltr" placeholder="DB Name (Ù†Ø§Ù… Ø¯ÛŒØªØ§Ø¨ÛŒØ³)" value={formData.dbName} onChange={e=>setFormData({...formData, dbName:e.target.value})} className="w-full p-2 border rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 transition-all"/>
                                            <input type="text" dir="ltr" placeholder="DB User (Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ)" value={formData.dbUser} onChange={e=>setFormData({...formData, dbUser:e.target.value})} className="w-full p-2 border rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 transition-all"/>
                                            <input type="password" dir="ltr" placeholder="DB Password (Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±)" value={formData.dbPassword} onChange={e=>setFormData({...formData, dbPassword:e.target.value})} className="w-full p-2 border rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 transition-all"/>
                                         </div>
                                    </div>

                                    <div className="pt-4 border-t">
                                        {botStatus && <div className={`mb-2 text-sm p-3 rounded-xl ${botStatus.success?'bg-emerald-50 text-emerald-800 border border-emerald-200':'bg-red-50 text-red-800 border border-red-200'}`}>{botStatus.message}</div>}
                                        <button type="button" onClick={handleCreateBot} disabled={botLoading} className="w-full py-3 bg-blue-600 text-white rounded-xl shadow-lg disabled:opacity-50 transition-all hover:bg-blue-700 flex items-center justify-center gap-2">{botLoading ? <Loader2 className="animate-spin"/> : <Zap size={18}/>} Ø³Ø§Ø®Øª Ø±Ø¨Ø§Øª Ùˆ Ø§ØªØµØ§Ù„ ÙˆØ¨â€ŒÙ‡ÙˆÚ©</button>
                                    </div>
                                </div>
                            )}
                            <button type="submit" className={`w-full py-3 rounded-xl shadow-lg mt-4 flex items-center justify-center gap-2 transition-all ${saved ? 'bg-emerald-500 text-white' : 'bg-emerald-500 text-white hover:bg-emerald-600'}`}>
                                <Save size={18} />
                                {saved ? 'Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯' : 'Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª'}
                            </button>
                         </form>
                    </div>
                </div>
            );
        };

        const BackupPage = ({ users, settings, onRestore }) => {
            const [botToken, setBotToken] = useState('');
            const [chatId, setChatId] = useState(settings.adminTelegramId || '');
            const [loading, setLoading] = useState(false);
            const [status, setStatus] = useState(null);
            const [restoreFile, setRestoreFile] = useState(null);
            const [restoreStatus, setRestoreStatus] = useState(null);
            const fileInputRef = useRef(null);

            const handleBackup = async (e) => {
                e.preventDefault();
                setLoading(true); setStatus(null);
                const blob = new Blob([JSON.stringify({users, settings, date: new Date()}, null, 2)], {type:'application/json'});
                const fd = new FormData();
                fd.append('chat_id', chatId);
                fd.append('document', blob, 'backup.json');
                fd.append('caption', 'ğŸ“¦ Ø¨Ú©Ø§Ù¾ ÙØ±ÙˆØ´Ú¯Ø§Ù‡');
                try {
                    const res = await fetch(`https://api.telegram.org/bot${botToken}/sendDocument`, { method:'POST', body: fd });
                    const d = await res.json();
                    setStatus({ success: d.ok, message: d.ok ? 'âœ… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯' : 'âŒ Ø®Ø·Ø§' });
                } catch { setStatus({ success: false, message: 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø·' }); }
                setLoading(false);
            };

            const handleRestore = (e) => {
                e.preventDefault();
                if (!restoreFile) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    try {
                        const data = JSON.parse(ev.target.result);
                        if(data.users && data.settings) { 
                            onRestore(data.users, data.settings); 
                            setRestoreStatus({success: true, message: 'âœ… Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯'});
                        } else {
                            throw new Error('Invalid format');
                        }
                    } catch { setRestoreStatus({success: false, message: 'âŒ ÙØ§ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø±'}); }
                };
                reader.readAsText(restoreFile);
            };

            return (
                <div className="max-w-2xl mx-auto space-y-8 animate-in">
                    <div className="bg-white p-6 rounded-3xl border space-y-4">
                        <h3 className="font-bold border-b pb-2">Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ</h3>
                        <form onSubmit={handleBackup} className="space-y-3">
                            <input type="text" dir="ltr" placeholder="Bot Token" value={botToken} onChange={e=>setBotToken(e.target.value)} className="w-full p-3 border rounded-xl" required/>
                            <input type="text" dir="ltr" placeholder="Chat ID" value={chatId} onChange={e=>setChatId(e.target.value)} className="w-full p-3 border rounded-xl" required/>
                            {status && <p className={`text-sm ${status.success?'text-green-600':'text-red-600'}`}>{status.message}</p>}
                            <button disabled={loading} className="w-full py-3 bg-blue-600 text-white rounded-xl">Ø§Ø±Ø³Ø§Ù„ Ø¨Ú©Ø§Ù¾ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…</button>
                        </form>
                    </div>
                    <div className="bg-white p-6 rounded-3xl border space-y-4">
                        <h3 className="font-bold border-b pb-2">Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ</h3>
                        <form onSubmit={handleRestore} className="space-y-3">
                             <input type="file" ref={fileInputRef} accept=".json" onChange={e=>setRestoreFile(e.target.files[0])} className="w-full p-3 border rounded-xl"/>
                             {restoreStatus && <p className={`text-sm ${restoreStatus.success?'text-green-600':'text-red-600'}`}>{restoreStatus.message}</p>}
                             <button disabled={!restoreFile} className="w-full py-3 bg-emerald-600 text-white rounded-xl">Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</button>
                        </form>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [currentPage, setCurrentPage] = useState('dashboard');
            const [users, setUsers] = useState([]);
            const [settings, setSettings] = useState(DEFAULT_SETTINGS);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                fetchData().then(data => {
                    setUsers(data.users);
                    setSettings(data.settings);
                    setLoading(false);
                });
            }, []);

            const persist = (newUsers, newSettings) => {
                setUsers(newUsers); setSettings(newSettings);
                saveData({ users: newUsers, settings: newSettings });
            };

            if (loading) return <div className="h-screen flex items-center justify-center text-slate-400"><Loader2 className="animate-spin mb-2" /> Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>;

            return (
                <div className="flex bg-slate-50 min-h-screen text-slate-800">
                    <Sidebar currentPage={currentPage} onChangePage={setCurrentPage} />
                    <main className="flex-1 flex flex-col h-screen overflow-hidden">
                        <header className="bg-white/80 backdrop-blur-md border-b p-4 sticky top-0 z-20 flex justify-center shadow-sm">
                            <div className="text-center">
                                <h1 className="text-2xl font-black bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">ÙØ±ÙˆØ´Ú¯Ø§Ù‡ ÙØ±ÙˆØ´ Ù‡ÛŒØ¯ÛŒÙØ§ÛŒ</h1>
                                <span className="text-xs text-slate-400">Ù…Ø¯ÛŒØ±ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§Ú©Ø§Ù†Øªâ€ŒÙ‡Ø§</span>
                            </div>
                        </header>
                        <div className="flex-1 overflow-y-auto p-4 md:p-8">
                            {currentPage === 'dashboard' && <DashboardPage users={users} settings={settings} />}
                            {currentPage === 'users' && <UsersPage users={users} settings={settings} onAddUser={(u)=>persist([u,...users].map(x=>x.id?x:{...x,id:crypto.randomUUID()}), settings)} onUpdateConsumption={(id,amt)=>persist(users.map(u=>u.id===id?{...u, consumedGb:u.consumedGb+amt, lastCheckDate:new Date().toISOString()}:u), settings)} onDeleteUser={(id)=>persist(users.filter(u=>u.id!==id), settings)} />}
                            {currentPage === 'bill' && <BillPage users={users} settings={settings} />}
                            {currentPage === 'backup' && <BackupPage users={users} settings={settings} onRestore={(u,s)=>persist(u,s)} />}
                            {currentPage === 'settings' && <SettingsPage settings={settings} onSave={(s)=>persist(users, s)} />}
                        </div>
                    </main>
                    <MobileNav currentPage={currentPage} onChangePage={setCurrentPage} />
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>